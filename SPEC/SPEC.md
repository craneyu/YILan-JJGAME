# 柔術競賽演武計分平台

> 版本：v1.0 ｜ 更新日期：2026-02-25

---

## 目錄

1. [系統概述](#1-系統概述)
2. [使用者角色](#2-使用者角色)
3. [術語定義](#3-術語定義)
4. [評分規則](#4-評分規則)
5. [功能需求](#5-功能需求)
6. [界面設計](#6-界面設計)
7. [技術架構](#7-技術架構)

---

## 1. 系統概述

建立一個專為柔術競賽**傳統演武**計分而設計的線上平台，提供裁判與觀眾方便、即時的計分與資訊呈現工具。

### 1.1 比賽形式

| 項目     | 說明                                              |
| -------- | ------------------------------------------------- |
| 比賽類型 | 傳統演武（本規格書主要對象）                      |
| 組別     | 男子組、女子組、混合組                            |
| 評分系列 | A 系列（A1–A4）、B 系列（B1–B4）、C 系列（C1–C4） |

### 1.2 各組適用系列

| 組別   | 適用系列                          |
| ------ | --------------------------------- |
| 男子組 | 全系列（A1–A4、B1–B4、C1–C4）     |
| 女子組 | 各系列 1–3（A1–A3、B1–B3、C1–C3） |
| 混合組 | 各系列 1–3（A1–A3、B1–B3、C1–C3） |

### 1.3 賽制輪次結構

每場比賽共進行 **3 輪**，每輪對應一個評分系列。同一輪內，所有參賽隊伍**依出賽順序逐組演練**，全部組別完成後才進入下一輪。

| 輪次（Round） | 對應系列 | 說明                   |
| ------------- | -------- | ---------------------- |
| Round 1（R1） | A 系列   | 所有隊伍依序演練 A1–A4 |
| Round 2（R2） | B 系列   | 所有隊伍依序演練 B1–B4 |
| Round 3（R3） | C 系列   | 所有隊伍依序演練 C1–C4 |

> 例：R2-G3 = 第二輪（B 系列）、第三組出賽隊伍。
> 女子組與混合組每輪僅演練各系列 1–3 個動作（如 A1–A3）。

---

## 2. 使用者角色

| 角色        | 人數 | 職責說明                                               |
| ----------- | ---- | ------------------------------------------------------ |
| 計分裁判    | 5 位 | 對每個動作進行 4 項（A/B 系列）或 5 項（C 系列）評分   |
| VR 裁判     | 1 位 | 針對同一系列的多樣性進行評分（摔技、地板技儘量不重複） |
| 賽序裁判    | 1 位 | 控制賽程流程，開放評分、推進下一動作、執行換組         |
| 觀眾 / 選手 | 不限 | 唯讀，即時查看比賽評分結果                             |
| 管理員      | 不限 | 建立賽事、管理選手分組、設定賽制參數                   |

---

## 3. 術語定義

| 術語     | 說明                                                                                                                         |
| -------- | ---------------------------------------------------------------------------------------------------------------------------- |
| 系列     | 動作分組單位，分為 A、B、C 三個系列                                                                                          |
| 動作編號 | 同系列內的序號，如 B1、B2                                                                                                    |
| 換組     | 當前隊伍所有系列完成後，切換至下一隊伍繼續評分的操作                                                                         |
| VRT      | VR 裁判評分小計（摔技多樣性 + 地板技多樣性）                                                                                 |
| TOT      | 當前系列目前累計合計分數                                                                                                     |
| P1–P5    | 各評分項目去掉最高最低分後3位裁判加總（每項最高 9 分）；P1＝①預擊、P2＝②拳腳、P3＝③摔技、P4＝④地板技；P5＝⑤武器（僅 C 系列） |
| R2-G1    | Round 2（B 系列）第 N 組出賽隊伍；輪次對應系列：R1=A、R2=B、R3=C                                                             |

---

## 4. 評分規則

### 4.1 計分裁判評分項目

#### A / B 系列（每個動作 4 個評分項目）

| 項目序 | 評分項目       | 可選分數   |
| ------ | -------------- | ---------- |
| ①      | 預擊與指定動作 | 3、2、1、0 |
| ②      | 拳腳反擊       | 3、2、1、0 |
| ③      | 摔技分數       | 3、2、1、0 |
| ④      | 地板技分數     | 3、2、1、0 |

> 每位計分裁判單一動作最高可評 **12 分**。
> 每個評分項目採計去掉最高分與最低分後，3 位裁判分數加總（最高 **9 分**）。
> A/B 系列單一動作有效最高分：9 × 4 = **36 分**。

#### C 系列（每個動作 5 個評分項目）

| 項目序 | 評分項目       | 可選分數   |
| ------ | -------------- | ---------- |
| ①      | 預擊與指定動作 | 3、2、1、0 |
| ②      | 拳腳反擊       | 3、2、1、0 |
| ③      | 摔技分數       | 3、2、1、0 |
| ④      | 地板技分數     | 3、2、1、0 |
| ⑤      | 武器控制分數   | 3、2、1、0 |

> 每位計分裁判單一動作最高可評 **15 分**。
> 每個評分項目採計去掉最高分與最低分後，3 位裁判分數加總（最高 **9 分**）。
> C 系列單一動作有效最高分：9 × 5 = **45 分**。

### 4.2 計分規則：去掉最高最低分

每個評分項目（如①預擊）收到 5 位裁判的分數後，**去掉最高分 1 個、去掉最低分 1 個**，取中間 3 位裁判的分數加總作為該項目的有效分數（P 值）。

| 步驟 | 說明                               | 範例（某項目5位裁判給分：3、3、2、2、1） |
| ---- | ---------------------------------- | ---------------------------------------- |
| 1    | 收集5位裁判對同一評分項目的分數    | 3、3、2、2、1                            |
| 2    | 去掉最高分（3）與最低分（1）各一個 | 剩餘：3、2、2                            |
| 3    | 加總剩餘3個分數                    | 3 + 2 + 2 = **7**                        |

> 若最高分或最低分有多個相同值，僅去掉其中一個。

### 4.3 VR 裁判評分項目

VR 裁判以**全系列**（如整個 A 系列）為單位進行多樣性評分，目的是確保摔技與地板技動作儘量不重複。

| 評分項目     | 可選分數 |
| ------------ | -------- |
| 摔技多樣性   | 2、1、0  |
| 地板技多樣性 | 2、1、0  |

> VR 裁判於該系列全部動作執行完畢後送出評分。

### 4.4 評分流程

1. 賽序裁判依出賽順序呼叫第一組隊伍上場，進行當前輪次對應系列的演練。
2. 選手執行完一個動作（如 B1）後，賽序裁判按下「開放評分」。
3. 5 位計分裁判各自完成 4（或 5）項評分後送出。
4. 5 位裁判均送出後，賽序裁判開放下一動作（如 B2），重複至該系列全部動作完成。
5. 同系列全部動作完成後，VR 裁判送出本系列多樣性評分。
6. 賽序裁判確認後按「換組」，系統切換至**下一組**繼續演練同系列。
7. 本輪所有組別演練完畢後，進入下一輪（對應下一個系列），重複流程。

---

## 5. 功能需求

### 5.1 賽程管理（管理員）

- 建立賽事，設定賽事名稱、日期、場地
- 管理參賽隊伍（隊伍名稱、隊員姓名、組別）
  - 隊伍名稱**可重複**；隊員姓名在同一賽事內**不可重複**（系統驗證唯一性）
- 支援以 **Excel（.xlsx）** 或 **CSV（.csv）** 檔案批次匯入參賽隊伍
  - 匯入格式：`隊伍名稱, 隊員一姓名, 隊員二姓名, 組別`
  - 匯入時自動檢查隊員姓名重複，衝突時提示錯誤並中止該筆匯入
- 設定各組適用系列與動作數量
- 管理輪次（Round）與出賽順序

### 5.2 計分裁判功能

- 賽序裁判開放評分後，評分操作區解鎖
- 依系列動態顯示 4 項（A/B）或 5 項（C）評分按鈕
- 每個評分項目同時只能選擇一個分數（單選高亮）
- 所有項目選分完成後「確認送出」按鈕才可點按
- 送出後評分區進入唯讀狀態，顯示本動作評分結果
- 左側持續顯示本系列各動作評分紀錄

### 5.3 VR 裁判功能

- 顯示當前系列選手的動作清單與已完成狀態
- 全系列動作完成後，開放摔技與地板技多樣性評分
- 送出後進入唯讀狀態，等待換組

### 5.4 賽序裁判功能

- 顯示當前系列所有動作與各裁判送出狀態（已送出 / 未送出）
- 確認 5 位計分裁判均送出後，才可按「開放下一動作」
- 確認 VR 裁判已送出後，才可按「換組」
- 換組後系統廣播切換事件，所有裁判端與觀眾端同步更新

### 5.5 觀眾 / 選手顯示功能

- 即時顯示當前隊伍累計總分與各動作分項分數
- 即時顯示當前動作各評分項目的5位裁判加總（P1–P4 / P1–P5）
- 顯示 VRT（VR 裁判小計）及 TOT（系列合計）
- 未完成動作欄位以「`-`」表示

### 5.6 成績即時同步

- 所有裁判送出評分後，觀眾端即時更新不需重新整理
- 賽序裁判的換組、開放評分等操作即時廣播至所有連線用戶端

---

## 6. 界面設計

### 6.0 設計語言：水晶玻璃風格（Glassmorphism）

全站採用 **Tailwind CSS 4.x** Utility-first 方案，視覺風格統一為**水晶玻璃（Glassmorphism）**。

#### 核心視覺規則

| 屬性          | 規範                                                                |
| ------------- | ------------------------------------------------------------------- |
| 背景模糊      | `backdrop-blur-md`（`backdrop-filter: blur(12px)`）                 |
| 半透明底色    | `bg-white/10` ～ `bg-white/20`（依層次深淺調整 opacity）            |
| 邊框          | `border border-white/30`，搭配 `rounded-2xl` 圓角                   |
| 陰影          | `shadow-xl` + `drop-shadow`，強化玻璃厚度感                         |
| 頁面底層背景  | 深色漸層（如 `from-slate-900 via-blue-950 to-slate-900`）作為對比底 |
| 強調色 / 高亮 | 藍色系 `blue-400` / `blue-500`，用於當前動作、按鈕啟用狀態          |
| 文字          | `text-white` 主文字，`text-white/70` 次要說明文字                   |
| 按鈕（啟用）  | `bg-blue-500/80 hover:bg-blue-400 backdrop-blur-sm`                 |
| 按鈕（停用）  | `bg-white/10 text-white/30 cursor-not-allowed`                      |
| 評分送出高亮  | 總分區塊 `bg-blue-500/60`，大字體白字（`text-4xl font-bold`）       |

#### Tailwind 4.x 整合方式

```css
/* src/styles.css */
@import "tailwindcss";

@theme {
  --color-glass-border: rgb(255 255 255 / 0.3);
  --color-glass-bg: rgb(255 255 255 / 0.12);
  --color-accent: theme(colors.blue.500);
}
```

- 不使用 `tailwind.config.js`；改由 CSS `@theme` 區塊定義設計 token
- 所有元件以 **Standalone** 方式引入，無全域模組

#### 圖示規範（Font Awesome 7）

- 使用 `@fortawesome/angular-fontawesome` Standalone 整合，於各元件單獨 import `FaIconComponent`
- 圖示風格統一選用 **Solid**（`fas`）系列；部分狀態切換用 **Regular**（`far`）
- 常用圖示對照：

| 用途          | 圖示名稱                       |
| ------------- | ------------------------------ |
| 評分送出      | `fa-check` / `fa-check-circle` |
| 等待中        | `fa-hourglass-half`            |
| 換組 / 下一組 | `fa-forward-step`              |
| 開放評分      | `fa-lock-open`                 |
| 鎖定（停用）  | `fa-lock`                      |
| 管理員        | `fa-user-shield`               |
| 裁判          | `fa-gavel`                     |
| 觀眾          | `fa-eye`                       |
| 上傳 / 匯入   | `fa-file-arrow-up`             |
| 警告          | `fa-triangle-exclamation`      |

#### 警告視窗規範（SweetAlert2 + Toast）

所有使用者操作回饋、確認對話框均透過 **SweetAlert2** 呈現，禁止使用瀏覽器原生 `alert()` / `confirm()`。

| 情境                   | 模式       | 設定重點                                                       |
| ---------------------- | ---------- | -------------------------------------------------------------- |
| 操作成功（送出評分等） | **Toast**  | `position: 'top-end'`、`timer: 2000`、`icon: 'success'`        |
| 操作失敗 / 驗證錯誤    | **Toast**  | `position: 'top-end'`、`timer: 3000`、`icon: 'error'`          |
| 匯入衝突警告           | **Toast**  | `position: 'top-end'`、`timer: 3500`、`icon: 'warning'`        |
| 危險操作確認（如換組） | **Dialog** | `icon: 'question'`、`showCancelButton: true`、需手動確認才執行 |
| 匯入結果摘要           | **Dialog** | `icon: 'info'`、顯示成功筆數 / 衝突明細                        |

Toast 樣式配合水晶玻璃風格，透過 `customClass` 覆寫背景為半透明深色（`bg-slate-800/90 backdrop-blur-md`）。

---

### 6.1 計分裁判界面

每位計分裁判（共 5 位）使用同一版界面，畫面左側為比賽資訊區，右側為評分操作區。評分操作區由賽序裁判開放後才解鎖，裁判無法自行開始評分。

#### 計分裁判評分流程（狀態切換說明）

```
賽序裁判                    計分裁判
    │                           │
    │  按「開放 B1 評分」        │
    │ ─────────────────────────>│  狀態一 → 狀態二（評分操作區開啟）
    │                           │  裁判對 B1 動作進行 4 項評分
    │                           │  按「確認送出」
    │                           │  → 狀態四（唯讀，等待下一動作）
    │                           │
    │  確認5位裁判皆已送出       │
    │  按「開放 B2 評分」        │
    │ ─────────────────────────>│  狀態四 → 狀態一 → 狀態二（B2 開始）
    │                           │  ...
    │                           │
    │  B1～B4 全部完成           │
    │  按「換組」                │
    │ ─────────────────────────>│  切換至下一隊伍，回到狀態一
```

> **計分裁判評分的觸發條件：由賽序裁判按「開放評分」後，評分操作區才會解鎖，裁判無法自行開始評分。**

#### 狀態一：等待賽序裁判開放評分（選手準備執行動作）

```
┌─────────────────────────────────────────────────────────────────────┐
│  計分裁判 #1     ｜  MIXED DUO TEAM OPEN WORLD  ｜  R2 - G1         │
├──────────────────────────────────┬──────────────────────────────────┤
│  【賽事資訊】                    │                                  │
│  隊伍：隊員一姓名 / 隊員二姓名   │                                  │
│  隊員姓名                        │  ⏳ 等待賽序裁判開放評分          │
│  組別：混合組                    │                                  │
│  ─────────────────────────────  │  選手正在進行 B1 動作演示         │
│  【當前動作】                    │  賽序裁判確認後將開放評分         │
│  系列：B 系列                    │                                  │
│  動作編號：B1  ← 準備中          │  （評分按鈕尚未開放）             │
└──────────────────────────────────┴──────────────────────────────────┘
```

#### 狀態二：評分進行中（A / B 系列，4項評分）

```
┌─────────────────────────────────────────────────────────────────────┐
│  計分裁判 #1     ｜  MIXED DUO TEAM OPEN WORLD  ｜  R2 - G1         │
├──────────────────────────────────┬──────────────────────────────────┤
│  【賽事資訊】                    │  【評分區】  當前動作：B1         │
│  隊伍：隊員一姓名 / 隊員二姓名   │  ─────────────────────────────  │
│  隊員姓名                        │  ① 預擊與指定動作                │
│  組別：混合組                    │     [ 3 ]  [ 2 ]  [ 1 ]  [ 0 ]  │
│  ─────────────────────────────  │                                  │
│  【當前動作】                    │  ② 拳腳反擊                      │
│  系列：B 系列                    │     [ 3 ]  [ 2 ]  [ 1 ]  [ 0 ]  │
│  動作編號：B1  ← 評分中          │                                  │
│                                  │  ③ 摔技分數                      │
│  【本場評分紀錄】                 │     [ 3 ]  [ 2 ]  [ 1 ]  [ 0 ]  │
│  B1： 待送出                     │                                  │
│  B2：  -                         │  ④ 地板技分數                    │
│  B3：  -                         │     [ 3 ]  [ 2 ]  [ 1 ]  [ 0 ]  │
│  B4：  -                         │  ─────────────────────────────  │
│                                  │         [ 確認送出 ]              │
└──────────────────────────────────┴──────────────────────────────────┘
```

#### 狀態三：評分進行中（C 系列，5項評分）

```
┌─────────────────────────────────────────────────────────────────────┐
│  計分裁判 #1     ｜  MIXED DUO TEAM OPEN WORLD  ｜  R2 - G1         │
├──────────────────────────────────┬──────────────────────────────────┤
│  【賽事資訊】                    │  【評分區】  當前動作：C1         │
│  隊伍：隊員一姓名 / 隊員二姓名   │  ─────────────────────────────  │
│  隊員姓名                        │  ① 預擊與指定動作                │
│  組別：混合組                    │     [ 3 ]  [ 2 ]  [ 1 ]  [ 0 ]  │
│  ─────────────────────────────  │                                  │
│  【當前動作】                    │  ② 拳腳反擊                      │
│  系列：C 系列                    │     [ 3 ]  [ 2 ]  [ 1 ]  [ 0 ]  │
│  動作編號：C1  ← 評分中          │                                  │
│                                  │  ③ 摔技分數                      │
│  【本場評分紀錄】                 │     [ 3 ]  [ 2 ]  [ 1 ]  [ 0 ]  │
│  C1： 待送出                     │                                  │
│  C2：  -                         │  ④ 地板技分數                    │
│  C3：  -                         │     [ 3 ]  [ 2 ]  [ 1 ]  [ 0 ]  │
│  C4：  -                         │                                  │
│                                  │  ⑤ 武器控制分數                  │
│                                  │     [ 3 ]  [ 2 ]  [ 1 ]  [ 0 ]  │
│                                  │  ─────────────────────────────  │
│                                  │         [ 確認送出 ]              │
└──────────────────────────────────┴──────────────────────────────────┘
```

#### 狀態四：本動作評分已送出（等待賽序裁判開放下一動作）

```
┌─────────────────────────────────────────────────────────────────────┐
│  計分裁判 #1     ｜  MIXED DUO TEAM OPEN WORLD  ｜  R2 - G1         │
├──────────────────────────────────┬──────────────────────────────────┤
│  【賽事資訊】                    │                                  │
│  隊伍：隊員一姓名 / 隊員二姓名   │   ✅ B1 評分已送出               │
│  隊員姓名                        │                                  │
│  組別：混合組                    │   ① 預擊與指定動作：  3          │
│  ─────────────────────────────  │   ② 拳腳反擊：        2          │
│  【當前動作】                    │   ③ 摔技分數：        2          │
│  系列：B 系列                    │   ④ 地板技分數：      1          │
│  動作編號：B1  ← 已完成          │   ─────────────────────────     │
│                                  │   本動作合計：         8 分      │
│  【本場評分紀錄】                 │                                  │
│  B1：  8  ✅                     │  ⏳ 等待賽序裁判開放下一動作      │
│  B2：  -                         │                                  │
│  B3：  -                         │  待5位裁判均送出後，              │
│  B4：  -                         │  賽序裁判將開放 B2 評分           │
└──────────────────────────────────┴──────────────────────────────────┘
```

#### 界面區域說明

| 區域         | 位置     | 內容                                                    |
| ------------ | -------- | ------------------------------------------------------- |
| 頁首列       | 頂部橫幅 | 裁判編號 ＋ 賽事名稱 ＋ 輪次組別                        |
| 賽事資訊區   | 左側上半 | 隊伍名稱、隊員姓名、組別                                |
| 當前動作區   | 左側中段 | 當前系列名稱、動作編號、狀態標示                        |
| 本場評分紀錄 | 左側下半 | 本系列各動作已送出分數橫覽                              |
| 評分操作區   | 右側     | 依系列動態顯示 4 或 5 個評分項目，每項提供 3/2/1/0 按鈕 |
| 確認送出按鈕 | 右側底部 | 所有項目選擇後才可點按，送出後鎖定                      |

#### 按鈕互動規則

- 每個評分項目同一時間只能選擇一個分數，選定後高亮顯示
- **確認送出**按鈕：尚未全部選分前呈灰色停用；全部選分後才啟用
- 送出後整個評分區進入唯讀狀態，顯示本動作評分結果
- 賽序裁判發出「換組」指令後，界面自動切換至下一隊伍的等待狀態

#### 狀態觸發來源總表

| 狀態                    | 觸發來源         | 觸發動作                                |
| ----------------------- | ---------------- | --------------------------------------- |
| 狀態一 → 狀態二         | **賽序裁判**     | 按下「開放 [動作編號] 評分」按鈕        |
| 狀態二 → 狀態四         | **計分裁判本人** | 所有評分項目選分完畢，按「確認送出」    |
| 狀態四 → 狀態一         | **賽序裁判**     | 確認5位裁判均送出後，按「開放下一動作」 |
| 任意狀態 → 新隊伍狀態一 | **賽序裁判**     | 本系列全部動作完成後，按「換組」        |

---

### 6.2 VR 裁判界面

VR 裁判以系列為單位評分，在同系列全部動作執行完畢後才送出多樣性評分。左側顯示隊伍資訊與本系列動作完成狀態，右側提供兩項評分欄位（動作回放預留功能，後續版本實作）。

```
┌─────────────────────────────────────────────────────────────────────┐
│  VR 裁判     ｜  MIXED DUO TEAM OPEN WORLD  ｜  R2 - G1             │
├──────────────────────────────────┬──────────────────────────────────┤
│  【賽事資訊】                    │  【多樣性評分】  系列：B          │
│  隊伍：隊員一姓名 / 隊員二姓名   │  ─────────────────────────────  │
│  隊員姓名                        │  ① 摔技多樣性                    │
│  組別：混合組                    │     [ 2 ]  [ 1 ]  [ 0 ]          │
│  ─────────────────────────────  │                                  │
│  【本系列動作狀態】               │  ② 地板技多樣性                  │
│  B1：✅ 已完成                   │     [ 2 ]  [ 1 ]  [ 0 ]          │
│  B2：✅ 已完成                   │  ─────────────────────────────  │
│  B3：✅ 已完成                   │         [ 確認送出 ]              │
│  B4：✅ 已完成                   │                                  │
│                                  │  （全系列完成後按鈕才啟用）        │
└──────────────────────────────────┴──────────────────────────────────┘
```

> **VR 裁判評分觸發條件：同系列所有動作均完成後，評分按鈕才解鎖。**

---

### 6.3 賽序裁判界面

賽序裁判負責控制比賽流程。界面左側顯示當前隊伍與系列狀態，右側顯示各裁判送出狀態，並提供流程控制按鈕。

```
┌─────────────────────────────────────────────────────────────────────┐
│  賽序裁判    ｜  MIXED DUO TEAM OPEN WORLD  ｜  R2 - G1             │
├──────────────────────────────────┬──────────────────────────────────┤
│  【賽事資訊】                    │  【計分裁判送出狀態】  動作：B1   │
│  隊伍：隊員一姓名 / 隊員二姓名   │  ─────────────────────────────  │
│  隊員姓名                        │  P1：✅ 已送出                   │
│  組別：混合組                    │  P2：✅ 已送出                   │
│  系列：B 系列                    │  P3：⏳ 等待中                   │
│  ─────────────────────────────  │  P4：✅ 已送出                   │
│  【系列進度】                    │  P5：✅ 已送出                   │
│  B1：⏳ 評分中                   │  ─────────────────────────────  │
│  B2：  -                         │  VR 裁判：  -（待全系列完成）    │
│  B3：  -                         │  ─────────────────────────────  │
│  B4：  -                         │  [ 開放 B1 評分 ]（已開放）      │
│                                  │  [ 開放 B2 評分 ]（灰色停用）    │
│                                  │  [ 換組 ]（灰色停用）            │
└──────────────────────────────────┴──────────────────────────────────┘
```

#### 賽序裁判按鈕啟用條件

| 按鈕         | 啟用條件                                |
| ------------ | --------------------------------------- |
| 開放下一動作 | 5 位計分裁判對當前動作均已送出          |
| 換組         | 本系列所有動作完成 **且** VR 裁判已送出 |

---

### 6.4 觀眾界面

整體畫面由四個水平區塊組成，由上至下排列：

**▼ A / B 系列動作顯示（區塊四顯示 P1～P4，各欄為5位裁判對該評分項目的加總）**

```
┌─────────────────────────────────────────────────────────────────────┐
│ 區塊一：賽事標題列（Competition Header Bar）                          │
│  賽事名稱 ＋ 輪次-組別  例：MIXED DUO TEAM OPEN WORLD  R2-G1         │
├──────────────────────┬──────────────────────────────────────────────┤
│ 區塊二左：當前累計總分 │ 區塊二右：隊伍資訊                           │
│                      │                                              │
│   168.0  (6)         │   隊員一姓名 / 隊員二姓名                    │
│  [藍底白字 大字體]    │   隊員姓名                                   │
│                      │                                              │
├──────┬───────┬───────┬───────┬─────┬─────┬────────┬───────────────┤
│ 區塊三：各動作分數總覽表（Action Score Summary Table）                │
├──────┬───────┬───────┬───────┬─────┬─────┬────────┬───────────────┤
│  B1  │  B2   │  B3   │  B4   │     │     │  VRT   │     TOT       │
├──────┼───────┼───────┼───────┼─────┼─────┼────────┼───────────────┤
│  32  │   -   │   -   │   -   │     │     │   -    │      32       │
├──────┴───────┴───────┴───────┴─────┴─────┴────────┴───────────────┤
│ 區塊四：當前動作各項目5位裁判加總列（Item Score Total Row）          │
├──────┬──────┬──────┬──────┬──────┬──────────────────────────────┤
│  B1  │  P1  │  P2  │  P3  │  P4  │                              │
│      │   9  │   8  │   8  │   7  │                              │
└──────┴──────┴──────┴──────┴──────┴──────────────────────────────┘
```

**▼ C 系列動作顯示（裁判明細列額外增加 P5 欄位，對應第5位計分裁判）**

> C 系列含武器控制分數，5位裁判各評5個分數，區塊三欄位改為 C1～C4，區塊四同樣顯示 P1～P5。

```
┌─────────────────────────────────────────────────────────────────────┐
│ 區塊一：賽事標題列（Competition Header Bar）                          │
│  賽事名稱 ＋ 輪次-組別  例：MIXED DUO TEAM OPEN WORLD  R2-G1         │
├──────────────────────┬──────────────────────────────────────────────┤
│ 區塊二左：當前累計總分 │ 區塊二右：隊伍資訊                           │
│                      │                                              │
│   210.0  (10)        │   隊員一姓名 / 隊員二姓名                    │
│  [藍底白字 大字體]    │   隊員姓名                                   │
│                      │                                              │
├──────┬───────┬───────┬───────┬─────┬─────┬────────┬───────────────┤
│ 區塊三：各動作分數總覽表（Action Score Summary Table）                │
├──────┬───────┬───────┬───────┬─────┬─────┬────────┬───────────────┤
│  C1  │  C2   │  C3   │  C4   │     │     │  VRT   │     TOT       │
├──────┼───────┼───────┼───────┼─────┼─────┼────────┼───────────────┤
│  40  │   -   │   -   │   -   │     │     │   -    │      40       │
├──────┴───────┴───────┴───────┴─────┴─────┴────────┴───────────────┤
│ 區塊四：當前動作各項目5位裁判加總列（Item Score Total Row）          │
├──────┬──────┬──────┬──────┬──────┬──────────────────────────────┤
│  C1  │  P1  │  P2  │  P3  │  P4  │  P5                          │
│      │   9  │   8  │   8  │   7  │   8                          │
└──────┴──────┴──────┴──────┴──────┴──────────────────────────────┘
```

#### 欄位說明

| 欄位代號 | 適用系列 | 意義                                                                                                     |
| -------- | -------- | -------------------------------------------------------------------------------------------------------- |
| R2-G1    | 全系列   | Round 2（B 系列）第 N 組出賽隊伍；輪次對應系列：R1=A、R2=B、R3=C                                         |
| 累計總分 | 全系列   | 該隊組目前所有已完成動作的累積分數                                                                       |
| (n)      | 全系列   | 已完成評分的動作數量                                                                                     |
| A1～A4   | A 系列   | A 系列第 1～4 組動作的小計分數                                                                           |
| B1～B4   | B 系列   | B 系列第 1～4 組動作的小計分數                                                                           |
| C1～C4   | C 系列   | C 系列第 1～4 組動作的小計分數                                                                           |
| VRT      | 全系列   | VR 裁判評分小計（摔技＋地板技多樣性分數）                                                                |
| TOT      | 全系列   | 本系列目前合計分數                                                                                       |
| P1～P4   | A/B 系列 | 各評分項目去掉最高最低分後3位裁判加總（每項最高 **9** 分）；P1＝①預擊、P2＝②拳腳、P3＝③摔技、P4＝④地板技 |
| P1～P5   | C 系列   | 同上，另加 P5＝⑤武器控制（每項最高 **9** 分）                                                            |

#### 顯示狀態說明

- `-`（破折號）：該欄尚未評分或本場次不計此欄
- 分數數值：該裁判 / 動作已確認送出的評分總和
- 藍底高亮：當前正在評分中的動作欄位
- 總分區塊（左上）採用**大字體藍底白字**設計，強調視覺焦點
- 區塊四的 P1～P5 欄位寬度平均分配，確保5位裁判分數均可清晰呈現

---

## 7. 技術架構

### 7.1 系統架構概觀

```
┌─────────────────────────────────────────────────────────────────────┐
│              用戶端（Browser）── 同一區網（Wi-Fi / LAN）              │
│                                                                     │
│  計分裁判 ×5  │  VR 裁判 ×1  │  賽序裁判 ×1  │  觀眾（不限）        │
│  Angular SPA（HTTP REST + WebSocket，連線至 MacBook Air 伺服器）      │
└─────────────────────────┬───────────────────────────────────────────┘
                           │  HTTPS / WSS
┌─────────────────────────▼───────────────────────────────────────────┐
│                    後端應用伺服器                                      │
│              Node.js + Express（RESTful API）                       │
│              Socket.IO Server（WebSocket 事件廣播）                  │
│              JWT 驗證中介層（角色權限控制）                            │
└─────────────────────────┬───────────────────────────────────────────┘
                           │  Mongoose ODM
┌─────────────────────────▼───────────────────────────────────────────┐
│                       MongoDB                                       │
│     events │ teams │ scores │ vr_scores │ users                    │
└─────────────────────────────────────────────────────────────────────┘
```

> 整體以 **Docker Compose** 封裝，三個服務（frontend、backend、mongo）一起啟動。

---

### 7.2 技術選型

| 層次     | 技術                    | 版本     | 說明                                                                                   |
| -------- | ----------------------- | -------- | -------------------------------------------------------------------------------------- |
| 前端     | Angular                 | 20       | **Standalone 元件**架構，搭配 Angular Signal 管理狀態；響應式 SPA，適配平板與桌面      |
| 樣式     | Tailwind CSS            | 4.x      | Utility-first CSS；`@import "tailwindcss"` 整合方式；水晶玻璃（Glassmorphism）視覺風格 |
| 後端     | Node.js + Express       | 22 / 5   | RESTful API + Socket.IO 伺服器                                                         |
| ODM      | Mongoose                | 8        | MongoDB Schema 定義與驗證                                                              |
| 資料庫   | MongoDB                 | 7        | 文件型 NoSQL，儲存賽事、評分等非結構化資料                                             |
| 即時通訊 | Socket.IO               | 4        | 雙向 WebSocket，廣播評分更新與流程控制事件                                             |
| 驗證     | jsonwebtoken            | 9        | JWT 無狀態身份驗證，依角色核發不同 payload                                             |
| 圖示     | Font Awesome            | 7        | SVG icon 套件；以 `<fa-icon>` Standalone 元件方式引入，按需載入                        |
| 警告視窗 | SweetAlert2             | 11       | 美化 alert / confirm 對話框；搭配 Toast 模式呈現操作回饋訊息                           |
| 容器化   | Docker + Docker Compose | 27 / 2.x | MacBook Air 本地一鍵啟動，區網裝置均可連線                                             |

---

### 7.3 資料模型（MongoDB Collections）

#### events（賽事）

| 欄位     | 型別     | 說明                            |
| -------- | -------- | ------------------------------- |
| `_id`    | ObjectId | 主鍵                            |
| `name`   | String   | 賽事名稱                        |
| `date`   | Date     | 比賽日期                        |
| `venue`  | String   | 場地                            |
| `rounds` | Number   | 輪次數量（固定 3）              |
| `status` | String   | `pending` / `active` / `closed` |

#### teams（隊伍）

| 欄位       | 型別     | 說明                               |
| ---------- | -------- | ---------------------------------- |
| `_id`      | ObjectId | 主鍵                               |
| `eventId`  | ObjectId | 關聯賽事                           |
| `name`     | String   | 隊伍名稱（同一賽事可重複）         |
| `members`  | String[] | 隊員姓名列表（同一賽事內唯一索引） |
| `category` | String   | `male` / `female` / `mixed`        |
| `order`    | Number   | 出賽順序                           |

#### scores（計分裁判評分）

| 欄位          | 型別     | 說明                                       |
| ------------- | -------- | ------------------------------------------ |
| `_id`         | ObjectId | 主鍵                                       |
| `eventId`     | ObjectId | 關聯賽事                                   |
| `teamId`      | ObjectId | 關聯隊伍                                   |
| `round`       | Number   | 輪次（1=A, 2=B, 3=C）                      |
| `actionNo`    | String   | 動作編號（如 `B1`）                        |
| `judgeId`     | ObjectId | 計分裁判 ID                                |
| `items`       | Object   | `{ p1, p2, p3, p4, p5 }`（各評分項目分數） |
| `submittedAt` | Date     | 送出時間                                   |

#### vr_scores（VR 裁判評分）

| 欄位            | 型別     | 說明                |
| --------------- | -------- | ------------------- |
| `_id`           | ObjectId | 主鍵                |
| `eventId`       | ObjectId | 關聯賽事            |
| `teamId`        | ObjectId | 關聯隊伍            |
| `round`         | Number   | 輪次                |
| `throwVariety`  | Number   | 摔技多樣性（0–2）   |
| `groundVariety` | Number   | 地板技多樣性（0–2） |
| `submittedAt`   | Date     | 送出時間            |

---

### 7.4 API 端點設計（RESTful）

所有端點前綴 `/api/v1`，需攜帶 `Authorization: Bearer <JWT>` 標頭（觀眾端唯讀 API 無需驗證）。

#### 賽事管理

| 方法  | 路徑          | 說明         | 角色   |
| ----- | ------------- | ------------ | ------ |
| GET   | `/events`     | 列出所有賽事 | 全部   |
| POST  | `/events`     | 建立賽事     | 管理員 |
| GET   | `/events/:id` | 取得賽事詳情 | 全部   |
| PATCH | `/events/:id` | 更新賽事狀態 | 管理員 |

#### 隊伍管理

| 方法  | 路徑                        | 說明             | 角色   |
| ----- | --------------------------- | ---------------- | ------ |
| GET   | `/events/:id/teams`         | 列出賽事所有隊伍 | 全部   |
| POST  | `/events/:id/teams`         | 新增隊伍         | 管理員 |
| PATCH | `/events/:id/teams/:teamId` | 更新隊伍資訊     | 管理員 |

#### 評分作業

| 方法 | 路徑                 | 說明             | 角色     |
| ---- | -------------------- | ---------------- | -------- |
| POST | `/scores`            | 計分裁判送出評分 | 計分裁判 |
| GET  | `/events/:id/scores` | 取得賽事全部評分 | 全部     |
| POST | `/vr-scores`         | VR 裁判送出評分  | VR 裁判  |

#### 流程控制

| 方法 | 路徑                | 說明         | 角色     |
| ---- | ------------------- | ------------ | -------- |
| POST | `/flow/open-action` | 開放動作評分 | 賽序裁判 |
| POST | `/flow/next-group`  | 換組         | 賽序裁判 |

---

### 7.5 即時通訊事件（Socket.IO）

所有用戶端加入賽事房間（`socket.join(eventId)`），伺服器以 `to(eventId).emit()` 廣播。

#### 伺服器 → 用戶端（廣播）

| 事件名稱           | 資料結構                                          | 說明                           |
| ------------------ | ------------------------------------------------- | ------------------------------ |
| `action:opened`    | `{ eventId, teamId, round, actionNo }`            | 賽序裁判開放某動作評分         |
| `score:submitted`  | `{ judgeId, teamId, round, actionNo, items }`     | 某計分裁判完成評分送出         |
| `score:calculated` | `{ teamId, round, actionNo, p1~p5, actionTotal }` | 5 位裁判全數送出，計算結果廣播 |
| `vr:submitted`     | `{ teamId, round, throwVariety, groundVariety }`  | VR 裁判完成評分送出            |
| `group:changed`    | `{ eventId, nextTeamId, round }`                  | 換組，切換至下一隊伍           |
| `round:changed`    | `{ eventId, round }`                              | 換輪，進入下一輪次             |

#### 用戶端 → 伺服器

| 事件名稱      | 說明                           |
| ------------- | ------------------------------ |
| `join:event`  | 加入賽事房間，開始接收即時更新 |
| `leave:event` | 離開賽事房間                   |

---

### 7.6 安全性與權限控制

#### JWT Payload 結構

```json
{
  "userId": "...",
  "role": "scoring_judge | vr_judge | sequence_judge | admin | audience",
  "judgeNo": 1,
  "eventId": "..."
}
```

> Token **不設過期時間**；系統僅作區網內部使用，關閉瀏覽器或重新選擇身份即視為登出。

#### 角色與 API 存取矩陣

| 角色        | 評分送出 | VR 評分 | 流程控制 | 管理賽事 | 查詢資料 |
| ----------- | :------: | :-----: | :------: | :------: | :------: |
| 計分裁判    |    ✅    |         |          |          |    ✅    |
| VR 裁判     |          |   ✅    |          |          |    ✅    |
| 賽序裁判    |          |         |    ✅    |          |    ✅    |
| 管理員      |          |         |    ✅    |    ✅    |    ✅    |
| 觀眾 / 選手 |          |         |          |          |    ✅    |

> 中介層依 JWT `role` 驗證每個請求，權限不足回傳 `403`。

---

### 7.7 部署架構（Docker Compose）

```yaml
# docker-compose.yml（示意）
services:
  frontend:
    build: ./frontend
    ports: ["4200:80"]
    depends_on: [backend]

  backend:
    build: ./backend
    ports: ["3000:3000"]
    environment:
      - MONGO_URI=mongodb://mongo:27017/jju
      - JWT_SECRET=<secret>
    depends_on: [mongo]

  mongo:
    image: mongo:7
    volumes:
      - mongo_data:/data/db

volumes:
  mongo_data:
```

| 服務     | 對應埠  | 說明                                             |
| -------- | ------- | ------------------------------------------------ |
| frontend | 4200→80 | Angular 靜態編譯檔，由 nginx 服務                |
| backend  | 3000    | Express + Socket.IO                              |
| mongo    | 27017   | MongoDB，資料以具名 volume（`mongo_data`）持久化 |

**資料庫持久化：**

- MongoDB 資料儲存於 Docker 具名 volume `mongo_data`，與容器映像完全分離
- 前後端程式碼更新（rebuild / redeploy）**不會影響資料庫內容**
- 僅執行 `docker compose up --build` 重建前後端映像時，`mongo_data` volume 持續保留

**網路存取方式：**

- 伺服器：MacBook Air 以 Docker Compose 啟動三個服務（frontend、backend、mongo）
- 所有裁判與觀眾透過**同一 Wi-Fi 區網**，在瀏覽器輸入 MacBook Air 的本地 IP（如 `http://192.168.x.x:4200`）即可連線
- 系統**不對外連線**；所有服務均在本地區網內執行，不依賴任何外部網路或雲端服務
