<div class="lp-wrapper">
  <!-- Background elements -->
  <div class="lp-bg-grid" aria-hidden="true"></div>
  <div class="lp-bg-glow" aria-hidden="true"></div>

  <main class="lp-main">

    <!-- ── 標題 ── -->
    <div class="lp-header-block">
      <div class="lp-header-accent" aria-hidden="true"></div>
      <p class="lp-sys-name">宜蘭柔術演武大賽</p>
      <h1 class="lp-title">競賽計分平台</h1>
      <p class="lp-subtitle">COMPETITION SCORING PLATFORM</p>
    </div>

    <!-- ══════════════════════════════════
         步驟一：登入
         ══════════════════════════════════ -->
    @if (loginStep() === 'login') {
      <div class="lp-cards">

        <!-- 觀眾 / 選手入口 -->
        <section class="lp-card">
          <div class="lp-card-label">
            <fa-icon [icon]="faEye" class="lp-card-icon"></fa-icon>
            <span>觀眾 / 選手觀賽</span>
          </div>
          <p class="lp-card-desc">選擇賽事後免登入，即可觀看即時計分</p>

          <div class="lp-input-row">
            <select [(ngModel)]="selectedEventId" class="lp-select">
              <option value="">── 選擇賽事 ──</option>
              @for (event of openEvents(); track event._id) {
                <option [value]="event._id">{{ event.name }}</option>
              }
            </select>
            <button class="lp-btn-enter" (click)="loginAsAudience(selectedEventId)">
              進入
            </button>
          </div>
        </section>

        <!-- 分隔線 -->
        <div class="lp-sep" aria-hidden="true">
          <div class="lp-sep-line"></div>
          <span class="lp-sep-text">裁判 / 管理員</span>
          <div class="lp-sep-line"></div>
        </div>

        <!-- 裁判 / 管理員登入 -->
        <section class="lp-card lp-card-judge">
          <div class="lp-card-label">
            <fa-icon [icon]="faGavel" class="lp-card-icon lp-card-icon--red"></fa-icon>
            <span>授權登入</span>
          </div>

          <div class="lp-fields">
            <div class="lp-field">
              <label class="lp-field-label">帳號</label>
              <input
                type="text"
                [(ngModel)]="username"
                (keyup.enter)="onLogin()"
                placeholder="請輸入帳號"
                class="lp-input"
                autocomplete="username" />
            </div>

            <div class="lp-field">
              <label class="lp-field-label">密碼</label>
              <input
                type="password"
                [(ngModel)]="password"
                (keyup.enter)="onLogin()"
                placeholder="請輸入密碼"
                class="lp-input"
                autocomplete="current-password" />
            </div>
          </div>

          <button
            class="lp-btn-login"
            [disabled]="loading()"
            (click)="onLogin()">
            @if (loading()) {
              <span class="lp-spinner"></span>
            } @else {
              <fa-icon [icon]="faLock" class="text-sm"></fa-icon>
            }
            <span>{{ loading() ? '驗證中...' : '登入系統' }}</span>
          </button>

          <div class="lp-hint">
            admin / judge1–5 / vr / seq &nbsp;·&nbsp; 密碼：admin123 / judge123 等
          </div>
        </section>

      </div>
    }

    <!-- ══════════════════════════════════
         步驟二：選擇賽事
         ══════════════════════════════════ -->
    @if (loginStep() === 'select-event') {
      <div class="lp-cards">
        <section class="lp-card lp-card-judge">
          <div class="lp-card-label">
            <fa-icon [icon]="faCalendarCheck" class="lp-card-icon lp-card-icon--red"></fa-icon>
            <span>選擇加入的賽事</span>
          </div>
          <p class="lp-card-desc">您的帳號尚未指定賽事，請選擇本次要加入的競賽</p>

          @if (openEvents().length === 0) {
            <div class="lp-empty">
              目前無可用賽事<br>
              <span>請聯絡管理員建立賽事後再嘗試</span>
            </div>
          } @else {
            <div class="lp-event-list">
              @for (event of openEvents(); track event._id) {
                <label
                  class="lp-event-item"
                  [class.lp-event-item--selected]="joinEventId === event._id">
                  <input
                    type="radio"
                    name="eventSelect"
                    [value]="event._id"
                    [(ngModel)]="joinEventId"
                    class="sr-only" />
                  <div class="lp-event-dot"
                       [class.lp-event-dot--active]="joinEventId === event._id">
                  </div>
                  <div class="lp-event-info">
                    <span class="lp-event-name">{{ event.name }}</span>
                    <span class="lp-event-meta">
                      {{ event.date ? (event.date | date:'yyyy/MM/dd') : '' }}
                      @if (event.status === 'active') {
                        <span class="lp-event-badge lp-event-badge--active">進行中</span>
                      } @else if (event.status === 'pending') {
                        <span class="lp-event-badge lp-event-badge--pending">準備中</span>
                      }
                    </span>
                  </div>
                </label>
              }
            </div>

            <button
              class="lp-btn-login"
              [disabled]="loading() || !joinEventId"
              (click)="confirmSelectEvent()">
              @if (loading()) {
                <span class="lp-spinner"></span>
              } @else {
                <fa-icon [icon]="faCalendarCheck" class="text-sm"></fa-icon>
              }
              <span>{{ loading() ? '處理中...' : '確認加入賽事' }}</span>
            </button>
          }

          <button class="lp-btn-back" (click)="loginStep.set('login')">
            ← 返回登入
          </button>
        </section>
      </div>
    }

  </main>
</div>
