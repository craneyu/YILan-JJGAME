<div class="min-h-screen flex items-center justify-center p-4">
  <div class="w-full max-w-md">

    <!-- 標題 -->
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-white mb-2">柔術競賽演武計分平台</h1>
      <p class="text-white/60">
        {{ loginStep() === 'select-event' ? '請選擇要加入的賽事' : '請選擇身份登入' }}
      </p>
    </div>

    <!-- ── 步驟一：登入 ── -->
    @if (loginStep() === 'login') {

      <!-- 觀眾 / 選手入口 -->
      <div class="glass-card p-6 mb-4">
        <div class="flex items-center gap-3 mb-4">
          <fa-icon [icon]="faEye" class="text-blue-400 text-xl"></fa-icon>
          <h2 class="text-white font-semibold text-lg">觀眾 / 選手</h2>
        </div>
        <p class="text-white/60 text-sm mb-4">無需登入，選擇賽事後即可觀看即時計分</p>
        <div class="flex gap-2">
          <select
            [(ngModel)]="selectedEventId"
            class="flex-1 bg-white/10 text-white border border-white/30 rounded-lg px-3 py-2 outline-none focus:border-blue-400">
            <option value="" class="bg-slate-800">請選擇賽事</option>
            @for (event of openEvents(); track event._id) {
              <option [value]="event._id" class="bg-slate-800">{{ event.name }}</option>
            }
          </select>
          <button class="primary-btn" (click)="loginAsAudience(selectedEventId)">進入</button>
        </div>
      </div>

      <!-- 裁判 / 管理員登入 -->
      <div class="glass-card p-6">
        <div class="flex items-center gap-3 mb-4">
          <fa-icon [icon]="faGavel" class="text-blue-400 text-xl"></fa-icon>
          <h2 class="text-white font-semibold text-lg">裁判 / 管理員</h2>
        </div>

        <div class="space-y-3">
          <div>
            <label class="text-white/70 text-sm block mb-1">帳號</label>
            <input type="text" [(ngModel)]="username" placeholder="請輸入帳號"
              (keyup.enter)="onLogin()"
              class="w-full bg-white/10 text-white border border-white/30 rounded-lg px-3 py-2 outline-none focus:border-blue-400 placeholder:text-white/30" />
          </div>

          <div>
            <label class="text-white/70 text-sm block mb-1">密碼</label>
            <input type="password" [(ngModel)]="password" placeholder="請輸入密碼"
              (keyup.enter)="onLogin()"
              class="w-full bg-white/10 text-white border border-white/30 rounded-lg px-3 py-2 outline-none focus:border-blue-400 placeholder:text-white/30" />
          </div>

          <button
            class="w-full primary-btn flex items-center justify-center gap-2 py-3"
            [class.opacity-60]="loading()"
            (click)="onLogin()"
            [disabled]="loading()">
            <fa-icon [icon]="faLock" class="text-sm"></fa-icon>
            {{ loading() ? '登入中...' : '登入' }}
          </button>
        </div>

        <div class="mt-4 pt-4 border-t border-white/10 space-y-1">
          <p class="text-white/40 text-xs text-center">預設帳號：admin / judge1~5 / vr / seq</p>
          <p class="text-white/40 text-xs text-center">密碼：admin123 / judge123 / vr123 / seq123</p>
        </div>
      </div>
    }

    <!-- ── 步驟二：選擇賽事 ── -->
    @if (loginStep() === 'select-event') {
      <div class="glass-card p-6">
        <div class="flex items-center gap-3 mb-2">
          <fa-icon [icon]="faCalendarCheck" class="text-blue-400 text-xl"></fa-icon>
          <h2 class="text-white font-semibold text-lg">選擇賽事</h2>
        </div>
        <p class="text-white/60 text-sm mb-6">您的帳號尚未指定賽事，請選擇本次要加入的競賽</p>

        @if (openEvents().length === 0) {
          <div class="text-center py-6">
            <p class="text-white/40">目前沒有可用的賽事</p>
            <p class="text-white/30 text-xs mt-1">請聯絡管理員建立賽事後再嘗試</p>
          </div>
        } @else {
          <div class="space-y-3">
            @for (event of openEvents(); track event._id) {
              <label class="flex items-center gap-3 p-3 rounded-xl cursor-pointer transition-all"
                [class]="joinEventId === event._id
                  ? 'bg-blue-500/30 border border-blue-400/50'
                  : 'bg-white/5 border border-white/10 hover:bg-white/10'">
                <input type="radio" name="eventSelect" [value]="event._id"
                  [(ngModel)]="joinEventId" class="accent-blue-500" />
                <div class="flex-1">
                  <p class="text-white font-medium">{{ event.name }}</p>
                  <p class="text-white/40 text-xs">
                    {{ event.date ? (event.date | date:'yyyy/MM/dd') : '' }}
                    {{ event.status === 'active' ? '・進行中' : event.status === 'pending' ? '・準備中' : '' }}
                  </p>
                </div>
              </label>
            }
          </div>

          <button
            class="w-full primary-btn py-3 mt-4 flex items-center justify-center gap-2 font-medium"
            [class.opacity-60]="loading()"
            [disabled]="loading() || !joinEventId"
            (click)="confirmSelectEvent()">
            <fa-icon [icon]="faCalendarCheck"></fa-icon>
            {{ loading() ? '處理中...' : '確認加入賽事' }}
          </button>
        }

        <button class="w-full glass-btn mt-2 text-sm" (click)="loginStep.set('login')">
          ← 返回登入
        </button>
      </div>
    }

  </div>
</div>
